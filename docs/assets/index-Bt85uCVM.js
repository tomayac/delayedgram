(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}})();const a=document.getElementById("video"),f=document.getElementById("photos"),g=document.getElementById("capture"),s=document.getElementById("canvas"),p=s.getContext("2d",{willReadFrequently:!0});let h=!1,d=null;async function w(l){const n=l.split(`
`).filter(i=>i[0]!=="#"&&i.trim()!==""),o=parseInt(n[1].split(" ")[0],10),e=parseInt(n[1].split(" ")[1],10),t=n.splice(3).join(`
`).split(/\s+/g).map(i=>parseInt(i,10)),r=new ImageData(o,e);for(let i=0,m=0;i<t.length;i+=3)r.data[m+0]=t[i+0],r.data[m+1]=t[i+1],r.data[m+2]=t[i+2],r.data[m+3]=255,m+=4;const y=await createImageBitmap(r),u=document.createElement("canvas");u.width=o,u.height=e,u.getContext("2d").drawImage(y,0,0),f.append(u)}async function v(){return new Promise(async(l,c)=>{try{const n={video:{facingMode:"user"}},o=await navigator.mediaDevices.getUserMedia(n);a.addEventListener("canplay",()=>{if(!h){const e=a.videoHeight,t=a.videoWidth;a.width=t,a.height=e,s.width=t,s.height=e,h=!0}l()}),a.srcObject=o}catch(n){c(n)}})}g.addEventListener("click",async()=>{if(f.innerHTML="",!a.srcObject)try{await v();return}catch(e){console.error("Error accessing camera:",e),alert(`Error accessing camera: ${e}`);return}g.classList.add("busy"),s.width=a.videoWidth,s.height=a.videoHeight,p.drawImage(a,0,0,s.width,s.height);const l=p.getImageData(0,0,s.width,s.height),c=`P3
${s.width} ${s.height}
255
`,n=Array.from(l.data).reduce((e,t,r)=>((r+1)%4!==0&&(e+=`${t} `),e),""),o=c+n;d&&(d.terminate(),d=null),d=new Worker("worker.js",{type:"module"}),d.addEventListener("message",e=>{const{ppmP3String:t,complete:r}=e.data;r&&(g.classList.remove("busy"),d.terminate(),d=null),w(t)}),d.postMessage({ppmP3String:o})});
